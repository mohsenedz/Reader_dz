<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Deutsch Vorleser</title>
</head>
<body>
  <h2>Text mit zwei Stimmen lesen</h2>

  <textarea id="text" rows="6" cols="60" placeholder="Max: Hallo Lisa.\nLisa: Hallo Max. Wie geht's?"></textarea>
  <br><br>

  <label>Stimme 1:</label>
  <select id="voice1"></select>
  <label>Geschwindigkeit:</label>
  <input type="range" id="rate1" min="0.5" max="2" value="1" step="0.1"><br><br>

  <label>Stimme 2:</label>
  <select id="voice2"></select>
  <label>Geschwindigkeit:</label>
  <input type="range" id="rate2" min="0.5" max="2" value="1" step="0.1"><br><br>

  <button onclick="speakText()">▶️ Start</button>
  <button onclick="pauseSpeech()">⏸ Pause</button>
  <button onclick="resumeSpeech()">▶️ Fortsetzen</button>
  <button onclick="stopSpeech()">⏹ Stopp</button>

  <script>
    const voiceSelect1 = document.getElementById("voice1");
    const voiceSelect2 = document.getElementById("voice2");

    function loadVoices() {
      const voices = speechSynthesis.getVoices();
      if (voices.length === 0) {
        setTimeout(loadVoices, 1000); // إعادة المحاولة بعد ثانية
        return;
      }

      voiceSelect1.innerHTML = '';
      voiceSelect2.innerHTML = '';
      voices.forEach((voice, index) => {
        const option1 = document.createElement("option");
        option1.value = index;
        option1.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect1.appendChild(option1);

        const option2 = option1.cloneNode(true);
        voiceSelect2.appendChild(option2);
      });
    }

    speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices(); // في حالة عدم استدعاء onvoiceschanged

    function speakText() {
      speechSynthesis.cancel(); // لإعادة التشغيل من البداية
      const text = document.getElementById("text").value.trim();
      if (!text) return;

      const lines = text.split("\n");
      const voices = speechSynthesis.getVoices();
      const voice1 = voices[voiceSelect1.value];
      const voice2 = voices[voiceSelect2.value];
      const rate1 = parseFloat(document.getElementById("rate1").value);
      const rate2 = parseFloat(document.getElementById("rate2").value);

      let delay = 0;
      for (let line of lines) {
        const utterance = new SpeechSynthesisUtterance(line);
        if (line.toLowerCase().startsWith("max")) {
          utterance.voice = voice1;
          utterance.rate = rate1;
        } else {
          utterance.voice = voice2;
          utterance.rate = rate2;
        }
        utterance.lang = utterance.voice.lang;
        utterance.text = line;
        speechSynthesis.speak(utterance);
      }
    }

    function pauseSpeech() {
      if (speechSynthesis.speaking) speechSynthesis.pause();
    }

    function resumeSpeech() {
      if (speechSynthesis.paused) speechSynthesis.resume();
    }

    function stopSpeech() {
      speechSynthesis.cancel();
    }
  </script>
</body>
</html>
