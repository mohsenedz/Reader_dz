<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>قراءة نص بصوتين</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    select, input, button { margin: 10px 0; display: block; width: 100%; }
  </style>
</head>
<body>

<h2>قراءة نص ألماني بصوتين</h2>

<label for="voice1">اختر الصوت الأول:</label>
<select id="voice1"></select>

<label for="speed1">سرعة الصوت الأول:</label>
<input type="range" id="speed1" min="0.5" max="2" step="0.1" value="1">

<label for="voice2">اختر الصوت الثاني:</label>
<select id="voice2"></select>

<label for="speed2">سرعة الصوت الثاني:</label>
<input type="range" id="speed2" min="0.5" max="2" step="0.1" value="1">

<label for="text">النص الألماني:</label>
<textarea id="text" rows="8" placeholder="اكتب نصاً بين شخصين هنا..."></textarea>

<button id="startBtn">تشغيل</button>
<button id="pauseBtn">إيقاف مؤقت</button>

<script>
let synth = window.speechSynthesis;
let voices = [];

function loadVoices() {
  voices = synth.getVoices().filter(v => v.lang.startsWith('de'));
  const voiceSelect1 = document.getElementById('voice1');
  const voiceSelect2 = document.getElementById('voice2');
  voiceSelect1.innerHTML = '';
  voiceSelect2.innerHTML = '';

  voices.forEach((voice, index) => {
    const option1 = document.createElement('option');
    option1.value = index;
    option1.textContent = voice.name + ' (' + voice.lang + ')';
    voiceSelect1.appendChild(option1);

    const option2 = document.createElement('option');
    option2.value = index;
    option2.textContent = voice.name + ' (' + voice.lang + ')';
    voiceSelect2.appendChild(option2);
  });
}

if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = loadVoices;
}

document.getElementById('startBtn').onclick = function() {
  synth.cancel(); // تأكد أن لا يوجد قراءة سابقة

  const text = document.getElementById('text').value.trim();
  if (!text) return alert('اكتب نصًا أولاً!');

  const parts = text.split(/(Max:|Lisa:)/).filter(p => p.trim() !== '');
  const voice1 = voices[document.getElementById('voice1').value];
  const speed1 = parseFloat(document.getElementById('speed1').value);
  const voice2 = voices[document.getElementById('voice2').value];
  const speed2 = parseFloat(document.getElementById('speed2').value);

  let utterances = [];

  for (let i = 0; i < parts.length; i += 2) {
    const speaker = parts[i];
    const sentence = parts[i + 1] || '';

    const utterance = new SpeechSynthesisUtterance(sentence.trim());
    if (speaker.includes('Max')) {
      utterance.voice = voice1;
      utterance.rate = speed1;
    } else if (speaker.includes('Lisa')) {
      utterance.voice = voice2;
      utterance.rate = speed2;
    } else {
      utterance.voice = voice1; // افتراضيًا إذا لم يتم التمييز
      utterance.rate = speed1;
    }
    utterances.push(utterance);
  }

  utterances.forEach(utt => synth.speak(utt));
};

document.getElementById('pauseBtn').onclick = function() {
  if (synth.speaking) {
    synth.pause();
  }
};
</script>

</body>
</html>
