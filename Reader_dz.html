
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Dialog Reader</title>
</head>
<body>
  <h1>Dialog Reader</h1>

  <textarea id="dialog" rows="10" cols="50" placeholder="Max: Hallo Lisa!\nLisa: Hallo Max!"></textarea>
  <br><br>

  <label for="maxVoice">Max Stimme:</label>
  <select id="maxVoice"></select>

  <label for="maxRate">Geschwindigkeit Max:</label>
  <input type="number" id="maxRate" value="1" step="0.1" min="0.1" max="3">
  <br><br>

  <label for="lisaVoice">Lisa Stimme:</label>
  <select id="lisaVoice"></select>

  <label for="lisaRate">Geschwindigkeit Lisa:</label>
  <input type="number" id="lisaRate" value="1" step="0.1" min="0.1" max="3">
  <br><br>

  <button onclick="playDialog()">Play</button>
  <button onclick="stopDialog()">Stop</button>

  <script>
    let voices = [];

    function populateVoiceList() {
      voices = speechSynthesis.getVoices();
      const maxVoiceSelect = document.getElementById('maxVoice');
      const lisaVoiceSelect = document.getElementById('lisaVoice');

      maxVoiceSelect.innerHTML = '';
      lisaVoiceSelect.innerHTML = '';

      voices.forEach((voice, index) => {
        const option1 = document.createElement('option');
        option1.value = index;
        option1.textContent = voice.name + ' (' + voice.lang + ')';

        const option2 = document.createElement('option');
        option2.value = index;
        option2.textContent = voice.name + ' (' + voice.lang + ')';

        maxVoiceSelect.appendChild(option1);
        lisaVoiceSelect.appendChild(option2);
      });
    }

    populateVoiceList();
    if (typeof speechSynthesis !== 'undefined' && speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = populateVoiceList;
    }

    function playDialog() {
      speechSynthesis.cancel();

      const dialog = document.getElementById('dialog').value.split(/[\r\n]+/);
      const maxVoice = voices[document.getElementById('maxVoice').value];
      const lisaVoice = voices[document.getElementById('lisaVoice').value];
      const maxRate = parseFloat(document.getElementById('maxRate').value);
      const lisaRate = parseFloat(document.getElementById('lisaRate').value);

      let queue = [];

      dialog.forEach(line => {
        let [speaker, text] = line.split(':').map(s => s.trim());
        if (speaker && text) {
          let utter = new SpeechSynthesisUtterance(text);
          if (speaker.toLowerCase() === 'max') {
            utter.voice = maxVoice;
            utter.rate = maxRate;
          } else if (speaker.toLowerCase() === 'lisa') {
            utter.voice = lisaVoice;
            utter.rate = lisaRate;
          }
          queue.push(utter);
        }
      });

      if (queue.length > 0) {
        let speakNext = function(index) {
          if (index < queue.length) {
            queue[index].onend = () => speakNext(index + 1);
            speechSynthesis.speak(queue[index]);
          }
        };
        speakNext(0);
      }
    }

    function stopDialog() {
      speechSynthesis.cancel();
    }
  </script>
</body>
</html>
